{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///home/behaylu/Documents/project/upwork/postwork/restaurantSaaS/frontend/lib/services/chatService.ts"],"sourcesContent":["import axios from '../axios'\n\n\nexport const chatService =  {\n  getMessages\n}\n\nasync function getMessages(data:{page:number,page_size?:number,search?:string, shop_id:string}){\n    return axios.get('/messages/',{params:{\n        ...data\n    }})\n}"],"names":[],"mappings":";;;AAAA;;AAGO,MAAM,cAAe;IAC1B;AACF;AAEA,eAAe,YAAY,IAAmE;IAC1F,OAAO,4GAAA,CAAA,UAAK,CAAC,GAAG,CAAC,cAAa;QAAC,QAAO;YAClC,GAAG,IAAI;QACX;IAAC;AACL","debugId":null}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///home/behaylu/Documents/project/upwork/postwork/restaurantSaaS/frontend/hook/usePagination.ts"],"sourcesContent":["import { useState, useMemo } from 'react';\n\nexport function usePagination() {\n    // Define available page sizes\n    const page_sizes = [10, 20, 30, 40, 50];\n\n    // State for current page, initialized to 1\n    const [page, setPage] = useState(1);\n    const [search,setSearch] = useState('')\n    // State for total count of items, initialized to 0\n    const [totalCount, setTotalCount] = useState(0);\n    // State for the number of items per page, initialized to 2\n    const [pageSize, setPageSize] = useState(page_sizes[0] || 10); // Default to the first page size or 10\n\n    // Calculate total pages dynamically\n    const totalPages = useMemo(() => {\n        if (pageSize === 0) return 0; // Avoid division by zero\n        return Math.ceil(totalCount / pageSize);\n    }, [totalCount, pageSize]);\n\n    // Handles moving to the next page\n    const handleNextPage = () => {\n        // Only proceed if the current page is less than the total number of pages\n        if (page < totalPages) {\n            setPage(prevPage => prevPage + 1);\n        }\n    };\n\n    // Handles moving to the previous page\n    const handlePrevPage = () => {\n        // Only proceed if the current page is greater than 1\n        if (page > 1) {\n            setPage(prevPage => prevPage - 1);\n        }\n    };\n\n    return {\n        page,\n        totalCount,\n        setPage,\n        setTotalCount,\n        handleNextPage,\n        handlePrevPage,\n        page_sizes,\n        pageSize, // Renamed to pageSize for consistency\n        setPageSize,\n        totalPages, // Expose totalPages for convenience\n        search,\n        setSearch\n    };\n}"],"names":[],"mappings":";;;AAAA;;AAEO,SAAS;IACZ,8BAA8B;IAC9B,MAAM,aAAa;QAAC;QAAI;QAAI;QAAI;QAAI;KAAG;IAEvC,2CAA2C;IAC3C,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,QAAO,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACpC,mDAAmD;IACnD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,2DAA2D;IAC3D,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,UAAU,CAAC,EAAE,IAAI,KAAK,uCAAuC;IAEtG,oCAAoC;IACpC,MAAM,aAAa,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QACvB,IAAI,aAAa,GAAG,OAAO,GAAG,yBAAyB;QACvD,OAAO,KAAK,IAAI,CAAC,aAAa;IAClC,GAAG;QAAC;QAAY;KAAS;IAEzB,kCAAkC;IAClC,MAAM,iBAAiB;QACnB,0EAA0E;QAC1E,IAAI,OAAO,YAAY;YACnB,QAAQ,CAAA,WAAY,WAAW;QACnC;IACJ;IAEA,sCAAsC;IACtC,MAAM,iBAAiB;QACnB,qDAAqD;QACrD,IAAI,OAAO,GAAG;YACV,QAAQ,CAAA,WAAY,WAAW;QACnC;IACJ;IAEA,OAAO;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;AACJ","debugId":null}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///home/behaylu/Documents/project/upwork/postwork/restaurantSaaS/frontend/app/%28client%29/%5BrestaurantId%5D/chat/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport { MessageType } from \"@/type/message.model\";\nimport { chatService } from \"@/lib/services/chatService\";\nimport { usePagination } from \"@/hook/usePagination\";\nexport default function ChatRoomPage() {\n  const params = useParams();\n  const roomId = params.restaurantId;\n  const [messages, setMessages] = useState<MessageType[]>([]);\n  const [input, setInput] = useState(\"\");\n  const pagination = usePagination();\n\n  //   const accessToken = localStorage.getItem(\"access\");\n  const socketRef = useRef<WebSocket | null>(null);\n  useEffect(() => {\n    console.log(roomId);\n    if (!roomId) return;\n    console.log(roomId);\n\n    const accessToken = localStorage.getItem(\"access\");\n    socketRef.current = new WebSocket(\n      `ws://localhost:8000/ws/chat/${roomId}/?token=${accessToken}`,\n    );\n\n    console.log(socketRef.current);\n    socketRef.current.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      setMessages((prev) => [...prev, data]);\n    };\n\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.close();\n      }\n    };\n  }, []);\n\n  const sendMessage = () => {\n    console.log(socketRef.current);\n    if (!socketRef.current) return;\n    if (input.trim() && socketRef.current.readyState == WebSocket.OPEN) {\n      socketRef.current.send(JSON.stringify({ text: input }));\n      setMessages((prev) => [...prev, { sender: \"You\", text: input }]);\n    }\n  };\n\n  const getMessages = () => {\n    if (!roomId) return;\n\n    chatService\n      .getMessages({\n        page: pagination.page,\n        search: pagination.search,\n        page_size: pagination.pageSize,\n        shop_id: roomId.toLocaleString(),\n      })\n      .then((res) => {\n        setMessages(res.data.data.results);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  useEffect(() => {\n    getMessages();\n  }, [pagination.page]);\n\n  return (\n    <div className=\"p-6 mt-10 relative h-screen\">\n      <h1>Chat with Restaurant</h1>\n      <div className=\"overflow-y-scroll border p-4 rounded bg-gray-100 mb-4 \">\n        {messages.map((msg, idx) => (\n          <div\n            key={idx}\n            className={msg.sender === \"You\" ? \"text-right\" : \"text-left\"}\n          >\n            <div className=\"inline-block px-3 py-2 rounded bg-white shadow mb-2\">\n              <strong>{msg.sender}</strong>\n              {msg.text}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"fixed bottom-40 flex gap-2\">\n        <input\n          className=\"flex-1 border-2 p-2 py-4 rounded border-[#C71F37] outline-none\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={(e) => e.key === \"Enter\" && sendMessage()}\n        />\n        <button\n          className=\"bg-[#C71F37] text-white px-4 rounded\"\n          onClick={sendMessage}\n        >\n          Send\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AAEA;AACA;AALA;;;;;;AAMe,SAAS;IACtB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,SAAS,OAAO,YAAY;IAClC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB,EAAE;IAC1D,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,aAAa,CAAA,GAAA,qHAAA,CAAA,gBAAa,AAAD;IAE/B,wDAAwD;IACxD,MAAM,YAAY,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAoB;IAC3C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,QAAQ,GAAG,CAAC;QACZ,IAAI,CAAC,QAAQ;QACb,QAAQ,GAAG,CAAC;QAEZ,MAAM,cAAc,aAAa,OAAO,CAAC;QACzC,UAAU,OAAO,GAAG,IAAI,UACtB,CAAC,4BAA4B,EAAE,OAAO,QAAQ,EAAE,aAAa;QAG/D,QAAQ,GAAG,CAAC,UAAU,OAAO;QAC7B,UAAU,OAAO,CAAC,SAAS,GAAG,CAAC;YAC7B,MAAM,OAAO,KAAK,KAAK,CAAC,MAAM,IAAI;YAClC,YAAY,CAAC,OAAS;uBAAI;oBAAM;iBAAK;QACvC;QAEA,OAAO;YACL,IAAI,UAAU,OAAO,EAAE;gBACrB,UAAU,OAAO,CAAC,KAAK;YACzB;QACF;IACF,GAAG,EAAE;IAEL,MAAM,cAAc;QAClB,QAAQ,GAAG,CAAC,UAAU,OAAO;QAC7B,IAAI,CAAC,UAAU,OAAO,EAAE;QACxB,IAAI,MAAM,IAAI,MAAM,UAAU,OAAO,CAAC,UAAU,IAAI,UAAU,IAAI,EAAE;YAClE,UAAU,OAAO,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC;gBAAE,MAAM;YAAM;YACpD,YAAY,CAAC,OAAS;uBAAI;oBAAM;wBAAE,QAAQ;wBAAO,MAAM;oBAAM;iBAAE;QACjE;IACF;IAEA,MAAM,cAAc;QAClB,IAAI,CAAC,QAAQ;QAEb,8HAAA,CAAA,cAAW,CACR,WAAW,CAAC;YACX,MAAM,WAAW,IAAI;YACrB,QAAQ,WAAW,MAAM;YACzB,WAAW,WAAW,QAAQ;YAC9B,SAAS,OAAO,cAAc;QAChC,GACC,IAAI,CAAC,CAAC;YACL,YAAY,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO;QACnC,GACC,KAAK,CAAC,CAAC;YACN,QAAQ,GAAG,CAAC;QACd;IACJ;IAEA,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;IACF,GAAG;QAAC,WAAW,IAAI;KAAC;IAEpB,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;0BAAG;;;;;;0BACJ,8OAAC;gBAAI,WAAU;0BACZ,SAAS,GAAG,CAAC,CAAC,KAAK,oBAClB,8OAAC;wBAEC,WAAW,IAAI,MAAM,KAAK,QAAQ,eAAe;kCAEjD,cAAA,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;8CAAQ,IAAI,MAAM;;;;;;gCAClB,IAAI,IAAI;;;;;;;uBALN;;;;;;;;;;0BAWX,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,WAAU;wBACV,OAAO;wBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBACxC,WAAW,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW;;;;;;kCAEzC,8OAAC;wBACC,WAAU;wBACV,SAAS;kCACV;;;;;;;;;;;;;;;;;;AAMT","debugId":null}}]
}